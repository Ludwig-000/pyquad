use pyo3::prelude::*;
use pyo3_stub_gen::derive::* ;
use pyo3::types::{PyWeakref, PyWeakrefReference};
use pyo3::exceptions::*;
use crate::engine::PChannel::PChannel;
use crate::py_abstractions::structs::ThreeDObjects::PhysicsHandle::Physics;
use std::hash::{Hash, Hasher};

use slotmap::DefaultKey;
use slotmap::Key;

use crate::engine::Objects::ObjectDataCache;
use crate::engine::CoreLoop::COMMAND_QUEUE;
use crate::engine::CoreLoop::Command;

use crate::py_abstractions::structs::GLAM::Vec3::Vec3;
use crate::py_abstractions::structs::ThreeDObjects::ColliderOptions::{ColliderOptions, InnerColliderOptions};
use crate::py_abstractions::structs::ThreeDObjects::ObjectFunctionStorage;
use crate::py_abstractions::Color::Color;
use crate::py_abstractions::structs::ThreeDObjects::ObjectFunctionStorage::FunctionKey;
use crate::engine::Objects::ObjectManagement::ObjectStorage::ObjectKey;



/// 
/// \e[48;5;235m  \e[38;5;235;48;5;235m▄▄▄\e[48;5;235m  \e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄▄▄\e[48;5;235m   \e[38;5;235;48;5;235m▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄▄\e[38;5;234;48;5;235m▄▄\e[38;5;235;48;5;235m▄▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄▄▄▄\e[48;5;235m  \e[38;5;233;48;5;233m▄\e[m
/// \e[48;5;235m \e[38;5;234;48;5;235m▄\e[38;5;235;48;5;235m▄▄▄▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄▄▄▄\e[38;5;234;48;5;235m▄\e[48;5;235m \e[38;5;234;48;5;235m▄\e[38;5;235;48;5;235m▄\e[38;5;240;48;5;235m▄\e[38;5;60;48;5;236m▄\e[38;5;238;48;5;235m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄\e[38;5;236;48;5;235m▄\e[38;5;237;48;5;235m▄\e[38;5;235;48;5;235m▄▄▄▄▄\e[38;5;236;48;5;235m▄\e[38;5;94;48;5;236m▄\e[38;5;235;48;5;235m▄▄▄▄▄▄\e[38;5;237;48;5;236m▄\e[38;5;236;48;5;235m▄\e[38;5;235;48;5;235m▄▄▄▄\e[38;5;236;48;5;235m▄\e[38;5;238;48;5;236m▄\e[38;5;239;48;5;237m▄\e[38;5;236;48;5;235m▄\e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;238;48;5;236m▄\e[38;5;246;48;5;238m▄\e[38;5;243;48;5;238m▄\e[38;5;235;48;5;235m▄\e[38;5;234;48;5;234m▄\e[48;5;235m  \e[38;5;237;48;5;236m▄\e[38;5;242;48;5;237m▄\e[38;5;242;48;5;238m▄\e[38;5;236;48;5;235m▄\e[38;5;234;48;5;234m▄\e[38;5;235;48;5;235m▄▄\e[38;5;237;48;5;237m▄\e[38;5;239;48;5;60m▄\e[38;5;8;48;5;8m▄\e[38;5;239;48;5;239m▄\e[38;5;237;48;5;236m▄\e[38;5;235;48;5;235m▄▄▄\e[38;5;238;48;5;237m▄\e[38;5;242;48;5;238m▄▄\e[38;5;238;48;5;236m▄\e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;58;48;5;58m▄\e[38;5;234;48;5;234m▄\e[38;5;243;48;5;239m▄\e[38;5;235;48;5;235m▄\e[38;5;58;48;5;237m▄\e[38;5;235;48;5;235m▄\e[38;5;235;48;5;234m▄\e[38;5;236;48;5;236m▄\e[38;5;236;48;5;235m▄\e[38;5;8;48;5;237m▄\e[38;5;238;48;5;235m▄\e[38;5;237;48;5;237m▄\e[38;5;235;48;5;235m▄▄\e[38;5;238;48;5;236m▄\e[38;5;59;48;5;239m▄\e[38;5;238;48;5;236m▄\e[38;5;239;48;5;236m▄\e[38;5;238;48;5;237m▄\e[38;5;238;48;5;236m▄\e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;236;48;5;238m▄\e[38;5;237;48;5;245m▄\e[38;5;237;48;5;242m▄\e[38;5;235;48;5;235m▄\e[48;5;234m \e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;236;48;5;237m▄\e[38;5;238;48;5;246m▄▄\e[38;5;235;48;5;237m▄\e[38;5;234;48;5;234m▄\e[48;5;235m \e[38;5;236;48;5;235m▄\e[38;5;238;48;5;238m▄\e[38;5;238;48;5;60m▄\e[38;5;238;48;5;246m▄\e[38;5;237;48;5;240m▄\e[38;5;239;48;5;238m▄\e[38;5;235;48;5;235m▄▄\e[38;5;236;48;5;236m▄\e[38;5;237;48;5;239m▄\e[38;5;237;48;5;243m▄\e[38;5;236;48;5;59m▄\e[38;5;237;48;5;238m▄\e[38;5;236;48;5;236m▄\e[38;5;235;48;5;235m▄\e[38;5;236;48;5;235m▄\e[38;5;94;48;5;94m▄\e[38;5;234;48;5;234m▄\e[38;5;236;48;5;242m▄\e[38;5;235;48;5;235m▄\e[38;5;94;48;5;94m▄\e[38;5;235;48;5;235m▄▄\e[38;5;235;48;5;236m▄\e[38;5;236;48;5;95m▄\e[38;5;236;48;5;8m▄\e[38;5;236;48;5;95m▄\e[38;5;95;48;5;95m▄\e[38;5;235;48;5;235m▄▄\e[38;5;240;48;5;240m▄\e[38;5;241;48;5;242m▄\e[38;5;237;48;5;242m▄\e[38;5;238;48;5;245m▄\e[38;5;238;48;5;241m▄\e[38;5;238;48;5;239m▄\e[38;5;236;48;5;236m▄\e[38;5;235;48;5;235m▄\e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;237m▄▄▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;234m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;235m▄▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;234m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;238m▄▄\e[38;5;235;48;5;237m▄▄\e[38;5;235;48;5;239m▄\e[38;5;235;48;5;235m▄▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;237m▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;237m▄\e[38;5;235;48;5;238m▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;235m▄▄\e[38;5;235;48;5;94m▄\e[38;5;235;48;5;237m▄▄\e[38;5;235;48;5;58m▄\e[38;5;235;48;5;94m▄\e[38;5;235;48;5;234m▄▄\e[38;5;235;48;5;235m▄\e[38;5;235;48;5;236m▄▄▄▄\e[38;5;235;48;5;234m▄\e[38;5;235;48;5;235m▄\e[38;5;235;48;5;237m▄\e[38;5;235;48;5;60m▄\e[38;5;235;48;5;239m▄\e[38;5;235;48;5;238m▄\e[38;5;235;48;5;239m▄\e[38;5;235;48;5;237m▄\e[38;5;235;48;5;235m▄▄\e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;236;48;5;237m▄▄▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;236;48;5;236m▄\e[38;5;236;48;5;237m▄▄\e[38;5;235;48;5;237m▄\e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;236m▄\e[38;5;236;48;5;237m▄▄▄\e[38;5;235;48;5;237m▄\e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;236;48;5;237m▄▄▄▄\e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;236;48;5;237m▄▄\e[38;5;236;48;5;236m▄\e[38;5;236;48;5;237m▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;235m▄▄\e[38;5;235;48;5;236m▄\e[38;5;236;48;5;237m▄▄▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;235m▄\e[38;5;235;48;5;234m▄\e[38;5;235;48;5;235m▄\e[38;5;235;48;5;236m▄\e[38;5;236;48;5;237m▄▄\e[38;5;236;48;5;236m▄\e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;234;48;5;235m▄\e[38;5;235;48;5;235m▄\e[38;5;236;48;5;235m▄\e[38;5;235;48;5;235m▄\e[38;5;234;48;5;235m▄\e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄▄\e[38;5;236;48;5;235m▄\e[38;5;237;48;5;235m▄\e[38;5;235;48;5;235m▄▄▄\e[48;5;235m     \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄▄\e[38;5;234;48;5;235m▄\e[38;5;236;48;5;235m▄\e[38;5;238;48;5;234m▄\e[38;5;235;48;5;235m▄▄▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;233;48;5;234m▄\e[m
/// \e[48;5;235m   \e[38;5;235;48;5;235m▄▄▄\e[38;5;239;48;5;235m▄\e[38;5;137;48;5;237m▄\e[38;5;239;48;5;94m▄\e[38;5;138;48;5;237m▄\e[38;5;95;48;5;236m▄\e[38;5;235;48;5;234m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m     \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄\e[38;5;238;48;5;235m▄\e[38;5;240;48;5;238m▄\e[38;5;102;48;5;59m▄\e[38;5;245;48;5;241m▄\e[38;5;241;48;5;238m▄\e[38;5;238;48;5;236m▄\e[38;5;236;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄\e[38;5;238;48;5;235m▄\e[38;5;95;48;5;238m▄\e[38;5;137;48;5;240m▄\e[38;5;144;48;5;101m▄\e[38;5;138;48;5;240m▄\e[38;5;95;48;5;237m▄\e[38;5;236;48;5;235m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄\e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m   \e[38;5;235;48;5;235m▄▄\e[38;5;238;48;5;239m▄\e[38;5;137;48;5;101m▄\e[38;5;248;48;5;181m▄\e[38;5;254;48;5;248m▄\e[38;5;181;48;5;251m▄\e[38;5;138;48;5;138m▄\e[38;5;95;48;5;95m▄\e[38;5;236;48;5;234m▄\e[38;5;234;48;5;234m▄\e[48;5;235m      \e[38;5;235;48;5;235m▄\e[38;5;239;48;5;236m▄\e[38;5;59;48;5;237m▄\e[38;5;243;48;5;59m▄\e[38;5;242;48;5;59m▄\e[38;5;245;48;5;246m▄\e[38;5;246;48;5;248m▄\e[38;5;243;48;5;242m▄\e[38;5;245;48;5;241m▄\e[38;5;243;48;5;238m▄\e[38;5;240;48;5;236m▄\e[38;5;235;48;5;235m▄\e[48;5;235m      \e[38;5;237;48;5;236m▄\e[38;5;94;48;5;237m▄\e[38;5;137;48;5;95m▄\e[38;5;254;48;5;181m▄\e[38;5;187;48;5;188m▄\e[38;5;181;48;5;255m▄\e[38;5;223;48;5;254m▄\e[38;5;254;48;5;180m▄\e[38;5;143;48;5;94m▄\e[38;5;240;48;5;236m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m   \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m   \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;236m▄\e[38;5;95;48;5;95m▄\e[38;5;95;48;5;137m▄\e[38;5;138;48;5;138m▄\e[38;5;181;48;5;254m▄\e[38;5;247;48;5;248m▄\e[38;5;237;48;5;8m▄\e[38;5;137;48;5;137m▄\e[38;5;235;48;5;239m▄\e[38;5;235;48;5;234m▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄\e[48;5;235m   \e[38;5;234;48;5;234m▄\e[38;5;240;48;5;235m▄\e[38;5;238;48;5;240m▄\e[38;5;243;48;5;246m▄\e[38;5;145;48;5;102m▄\e[38;5;59;48;5;239m▄\e[38;5;239;48;5;241m▄\e[38;5;246;48;5;242m▄\e[38;5;102;48;5;245m▄\e[38;5;239;48;5;243m▄\e[38;5;240;48;5;237m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄▄\e[38;5;239;48;5;236m▄\e[38;5;94;48;5;58m▄\e[38;5;137;48;5;137m▄\e[38;5;180;48;5;224m▄\e[38;5;255;48;5;253m▄\e[38;5;15;48;5;187m▄\e[38;5;255;48;5;186m▄\e[38;5;143;48;5;187m▄\e[38;5;94;48;5;137m▄\e[38;5;238;48;5;237m▄\e[38;5;238;48;5;235m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m  \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m    \e[38;5;234;48;5;235m▄\e[38;5;235;48;5;236m▄\e[38;5;236;48;5;58m▄\e[38;5;237;48;5;236m▄\e[38;5;238;48;5;101m▄\e[38;5;237;48;5;236m▄\e[38;5;238;48;5;237m▄\e[38;5;235;48;5;236m▄\e[38;5;234;48;5;234m▄\e[48;5;235m  \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;235;48;5;234m▄\e[38;5;234;48;5;237m▄\e[38;5;235;48;5;243m▄\e[38;5;239;48;5;241m▄\e[38;5;241;48;5;247m▄\e[38;5;102;48;5;252m▄▄\e[38;5;242;48;5;249m▄\e[38;5;240;48;5;242m▄\e[38;5;236;48;5;242m▄\e[38;5;234;48;5;238m▄\e[38;5;235;48;5;235m▄\e[48;5;235m    \e[38;5;235;48;5;236m▄\e[38;5;238;48;5;58m▄\e[38;5;95;48;5;95m▄\e[38;5;58;48;5;95m▄▄\e[38;5;95;48;5;240m▄\e[38;5;95;48;5;95m▄\e[38;5;95;48;5;249m▄\e[38;5;95;48;5;241m▄\e[38;5;95;48;5;101m▄\e[38;5;58;48;5;137m▄\e[38;5;58;48;5;95m▄\e[38;5;95;48;5;95m▄\e[38;5;237;48;5;238m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[m
/// \e[48;5;235m    \e[38;5;235;48;5;235m▄\e[38;5;234;48;5;235m▄▄\e[38;5;234;48;5;236m▄▄▄\e[38;5;234;48;5;235m▄▄\e[38;5;235;48;5;234m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m  \e[38;5;235;48;5;235m▄\e[48;5;235m    \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;238m▄\e[38;5;235;48;5;239m▄\e[38;5;235;48;5;240m▄▄\e[38;5;235;48;5;239m▄\e[38;5;235;48;5;238m▄\e[38;5;235;48;5;236m▄\e[38;5;235;48;5;235m▄\e[48;5;235m     \e[38;5;235;48;5;235m▄▄\e[38;5;235;48;5;238m▄\e[38;5;234;48;5;237m▄\e[38;5;235;48;5;237m▄\e[38;5;235;48;5;239m▄▄▄▄\e[38;5;235;48;5;238m▄\e[38;5;234;48;5;237m▄\e[38;5;234;48;5;238m▄\e[38;5;235;48;5;237m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m  \e[38;5;234;48;5;235m▄\e[m
/// \e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[38;5;236;48;5;236m▄\e[38;5;238;48;5;238m▄\e[38;5;238;48;5;237m▄\e[38;5;237;48;5;237m▄▄\e[48;5;235m    \e[38;5;235;48;5;235m▄▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;236;48;5;236m▄\e[38;5;237;48;5;238m▄\e[38;5;237;48;5;237m▄▄\e[38;5;238;48;5;238m▄\e[38;5;236;48;5;236m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;237;48;5;237m▄▄\e[38;5;238;48;5;238m▄▄\e[38;5;237;48;5;237m▄▄\e[38;5;236;48;5;236m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄▄\e[48;5;235m \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m      \e[38;5;235;48;5;235m▄▄▄▄▄\e[48;5;235m             \e[38;5;235;48;5;235m▄▄▄▄▄▄\e[48;5;235m      \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄▄▄▄▄▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m    \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m   \e[38;5;235;48;5;235m▄▄▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄▄▄\e[38;5;23;48;5;235m▄\e[38;5;235;48;5;235m▄▄▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄▄▄\e[48;5;235m  \e[38;5;234;48;5;235m▄\e[38;5;234;48;5;234m▄\e[38;5;233;48;5;234m▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄\e[38;5;234;48;5;234m▄\e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m   \e[38;5;235;48;5;235m▄\e[38;5;239;48;5;235m▄▄\e[38;5;235;48;5;235m▄▄\e[38;5;235;48;5;234m▄\e[38;5;242;48;5;235m▄\e[38;5;79;48;5;237m▄\e[38;5;116;48;5;66m▄\e[38;5;116;48;5;79m▄\e[38;5;116;48;5;241m▄\e[38;5;72;48;5;236m▄\e[38;5;237;48;5;235m▄\e[38;5;235;48;5;235m▄▄\e[38;5;236;48;5;235m▄\e[38;5;241;48;5;235m▄\e[38;5;236;48;5;235m▄\e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;234;48;5;234m▄▄\e[38;5;234;48;5;233m▄\e[38;5;234;48;5;234m▄\e[38;5;235;48;5;234m▄\e[38;5;234;48;5;234m▄\e[38;5;234;48;5;233m▄\e[48;5;233m \e[38;5;233;48;5;233m▄\e[38;5;234;48;5;234m▄\e[38;5;237;48;5;234m▄\e[38;5;236;48;5;234m▄\e[38;5;234;48;5;233m▄\e[48;5;233m  \e[38;5;234;48;5;234m▄\e[38;5;237;48;5;234m▄\e[38;5;236;48;5;234m▄\e[38;5;234;48;5;233m▄\e[38;5;233;48;5;233m▄▄▄\e[48;5;233m  \e[48;5;234m \e[48;5;235m    \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m  \e[38;5;235;48;5;235m▄\e[38;5;236;48;5;236m▄\e[38;5;23;48;5;6m▄\e[38;5;72;48;5;66m▄\e[38;5;66;48;5;238m▄\e[38;5;66;48;5;237m▄\e[38;5;72;48;5;23m▄\e[38;5;80;48;5;73m▄\e[38;5;79;48;5;80m▄\e[38;5;116;48;5;73m▄\e[38;5;116;48;5;79m▄\e[38;5;116;48;5;116m▄\e[38;5;116;48;5;73m▄\e[38;5;73;48;5;66m▄\e[38;5;66;48;5;236m▄\e[38;5;242;48;5;236m▄\e[38;5;66;48;5;241m▄\e[38;5;72;48;5;30m▄\e[38;5;238;48;5;238m▄\e[38;5;235;48;5;235m▄\e[48;5;235m  \e[48;5;234m  \e[38;5;234;48;5;234m▄\e[38;5;235;48;5;234m▄\e[38;5;236;48;5;236m▄\e[38;5;235;48;5;235m▄\e[38;5;234;48;5;234m▄\e[38;5;235;48;5;233m▄\e[38;5;234;48;5;233m▄\e[38;5;236;48;5;236m▄\e[38;5;241;48;5;242m▄\e[38;5;239;48;5;240m▄\e[38;5;235;48;5;235m▄\e[38;5;235;48;5;234m▄\e[38;5;234;48;5;234m▄\e[38;5;236;48;5;235m▄\e[38;5;239;48;5;239m▄\e[38;5;236;48;5;238m▄\e[38;5;235;48;5;235m▄\e[38;5;235;48;5;234m▄\e[38;5;236;48;5;235m▄\e[38;5;234;48;5;234m▄\e[38;5;234;48;5;233m▄\e[48;5;233m \e[48;5;234m \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;234m▄\e[m
/// \e[48;5;235m  \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;236m▄\e[38;5;238;48;5;23m▄\e[38;5;66;48;5;72m▄\e[38;5;73;48;5;73m▄\e[38;5;79;48;5;73m▄\e[38;5;79;48;5;79m▄\e[38;5;79;48;5;80m▄\e[38;5;73;48;5;73m▄\e[38;5;115;48;5;116m▄\e[38;5;116;48;5;152m▄\e[38;5;73;48;5;80m▄▄\e[38;5;79;48;5;116m▄\e[38;5;116;48;5;73m▄\e[38;5;73;48;5;72m▄\e[38;5;73;48;5;73m▄\e[38;5;29;48;5;66m▄\e[38;5;235;48;5;237m▄\e[48;5;235m   \e[48;5;234m  \e[38;5;233;48;5;234m▄▄▄\e[38;5;234;48;5;234m▄\e[38;5;236;48;5;235m▄\e[38;5;243;48;5;240m▄\e[38;5;235;48;5;235m▄\e[38;5;234;48;5;235m▄\e[38;5;233;48;5;234m▄\e[38;5;234;48;5;234m▄\e[38;5;238;48;5;237m▄\e[38;5;243;48;5;239m▄\e[38;5;239;48;5;237m▄\e[38;5;234;48;5;236m▄\e[38;5;233;48;5;235m▄\e[38;5;233;48;5;234m▄\e[38;5;235;48;5;235m▄\e[38;5;8;48;5;238m▄\e[38;5;145;48;5;241m▄\e[38;5;236;48;5;235m▄\e[38;5;235;48;5;234m▄\e[48;5;233m \e[48;5;234m \e[48;5;235m    \e[38;5;235;48;5;235m▄\e[m
/// \e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;236m▄\e[38;5;237;48;5;6m▄\e[38;5;242;48;5;72m▄\e[38;5;72;48;5;73m▄\e[38;5;73;48;5;79m▄\e[38;5;72;48;5;73m▄\e[38;5;79;48;5;116m▄\e[38;5;116;48;5;80m▄\e[38;5;116;48;5;116m▄\e[38;5;116;48;5;80m▄\e[38;5;73;48;5;79m▄\e[38;5;72;48;5;73m▄\e[38;5;73;48;5;79m▄\e[38;5;66;48;5;73m▄\e[38;5;239;48;5;72m▄\e[38;5;235;48;5;238m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m  \e[38;5;234;48;5;234m▄\e[48;5;234m \e[48;5;233m   \e[38;5;233;48;5;234m▄\e[38;5;234;48;5;236m▄\e[38;5;234;48;5;239m▄\e[38;5;234;48;5;237m▄\e[38;5;233;48;5;234m▄\e[38;5;233;48;5;233m▄\e[38;5;233;48;5;234m▄\e[38;5;234;48;5;236m▄\e[38;5;234;48;5;239m▄\e[38;5;234;48;5;238m▄\e[38;5;234;48;5;235m▄\e[38;5;233;48;5;233m▄\e[48;5;233m \e[38;5;237;48;5;236m▄\e[38;5;237;48;5;237m▄\e[38;5;237;48;5;239m▄\e[38;5;236;48;5;235m▄\e[38;5;234;48;5;234m▄\e[48;5;233m \e[48;5;234m \e[48;5;235m  \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m     \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;237m▄\e[38;5;235;48;5;66m▄\e[38;5;235;48;5;73m▄\e[38;5;235;48;5;66m▄\e[38;5;235;48;5;6m▄▄▄\e[38;5;235;48;5;66m▄\e[38;5;235;48;5;6m▄\e[38;5;234;48;5;66m▄\e[38;5;235;48;5;72m▄\e[38;5;235;48;5;240m▄\e[38;5;235;48;5;235m▄▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[48;5;234m  \e[48;5;233m  \e[38;5;233;48;5;233m▄▄\e[48;5;233m \e[38;5;234;48;5;233m▄\e[38;5;235;48;5;233m▄▄▄▄▄\e[38;5;237;48;5;233m▄\e[38;5;235;48;5;233m▄▄\e[38;5;237;48;5;233m▄\e[38;5;234;48;5;233m▄\e[38;5;233;48;5;233m▄▄▄▄▄\e[48;5;233m \e[48;5;234m \e[48;5;235m    \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m    \e[38;5;235;48;5;235m▄\e[48;5;235m    \e[38;5;235;48;5;235m▄\e[38;5;239;48;5;236m▄\e[38;5;59;48;5;236m▄\e[38;5;240;48;5;236m▄▄\e[38;5;238;48;5;236m▄\e[48;5;235m         \e[48;5;234m \e[38;5;234;48;5;234m▄\e[38;5;234;48;5;233m▄▄▄▄▄\e[38;5;234;48;5;234m▄\e[38;5;234;48;5;236m▄\e[38;5;234;48;5;235m▄▄▄▄▄▄▄▄\e[38;5;234;48;5;234m▄\e[38;5;234;48;5;233m▄▄▄▄▄▄\e[38;5;234;48;5;234m▄\e[48;5;235m    \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m    \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄▄▄▄▄\e[48;5;235m     \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[38;5;235;48;5;234m▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;234;48;5;234m▄\e[m
/// \e[48;5;235m  \e[38;5;235;48;5;235m▄\e[48;5;235m          \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[48;5;235m    \e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m   \e[38;5;235;48;5;235m▄▄\e[48;5;235m            \e[38;5;233;48;5;234m▄\e[m
/// \e[38;5;235;48;5;235m▄▄\e[48;5;235m          \e[38;5;235;48;5;235m▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m      \e[38;5;235;48;5;235m▄\e[48;5;235m      \e[38;5;235;48;5;235m▄\e[48;5;235m     \e[38;5;235;48;5;235m▄▄\e[48;5;235m \e[38;5;235;48;5;235m▄\e[48;5;235m  \e[38;5;235;48;5;235m▄▄\e[48;5;235m           \e[38;5;233;48;5;233m▄\e[m
///
#[gen_stub_pyclass]
#[pyclass(subclass, weakref)]
pub struct Pill{
    key: ObjectKey, // The key to the actual underlying cube, stored inside "ObjectStorage".

    // Key to a function inside 'function storage', which will be run each frame by the engine.
    function_key: Option<FunctionKey>,

    /// we add a cache for trivial data, which can be used if the object is not
    /// influenced by outside forces F.E. Gravity.
    cache: Option<ObjectDataCache::ThreeDObjCache>,

    /// a collection of physics-related methods, that can be applied to the object.
    /// 'physics' will be set to Some() if the object is innitialized as a dynamic object.
    #[pyo3(get)]
    pub physics: Option<Py<Physics>>,
}

crate::implement_basic_magic_methods3D!(Pill);
crate::implement_basic_getter_methods3D!(Pill);
crate::implement_basic_setter_methods3D!(Pill);
crate::implement_check_collision3D!(Pill);
crate::implement_set_collider3D!(Pill);
crate::implement_tick3D!(Pill,  r#"Pill()"#);
crate::implement_remove_tick3D!(Pill);
crate::implement_Drop3D!(Pill);

#[gen_stub_pymethods]
#[pymethods]
impl Pill {

    #[pyo3(signature = (position= Vec3::ZERO(), rotation = Vec3::ZERO(),scale= Vec3::ONE(), color = Color::WHITE(), collider_type = ColliderOptions::NONE()))]
    #[new]
    pub fn new(
        py: Python<'_>,
        position: Vec3,
        rotation: Vec3,
        scale: Vec3,
        color: Color,
        collider_type: ColliderOptions,
    ) -> PyResult<Py<Pill>> {

        let (sender, receiver) = PChannel::sync_channel(1);

        let cache  =match collider_type.0{
            InnerColliderOptions::Dynamic { gravity_scale, friction, restitution, density }=>{
                None
            },
            _=> {ObjectDataCache::ThreeDObjCache::new(true, position.into(), rotation.into(), scale.into(), color.into())}
        };
        let placeholder_struct = Self { key: ObjectKey::null(),function_key: None,  cache, physics: None};
        let cube_handle: Py<Self> = Py::new(py, placeholder_struct)?; 
        
        let weak_ref_handle: Py<PyWeakref> = {
            let bound_cube = cube_handle.bind(py); 
            let weak_ref_ref = PyWeakrefReference::new(&bound_cube)?;
            weak_ref_ref.cast_into::<PyWeakref>()?.unbind() 
        };

        COMMAND_QUEUE.push(Command::CreatePill { 
            size: scale.into(), 
            position: position.into(), 
            rotation: rotation.into(), 
            color: color.into(),
            collider: collider_type,
            weak_ref: weak_ref_handle.clone_ref(py),
            sender 
        });
        
        let key = receiver.recv()?;
        
        let mut cube_ref = cube_handle.borrow_mut(py);
        cube_ref.key = key;

        match collider_type.0{
            InnerColliderOptions::Dynamic { gravity_scale, friction, restitution, density }=>{
                let phys_struct = Physics {
                    identity: weak_ref_handle,
                    handle: key,
                };
                cube_ref.physics = Some(Py::new(py, phys_struct)?);
            },
            _ => {}
        }

        drop(cube_ref);

        Ok(cube_handle)
    }
        
        

}